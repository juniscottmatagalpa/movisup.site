<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Descargar video Sora</title>
</head>
<body>
  <h3>Descargar video desde Sora</h3>
  <input id="inputUrl" placeholder="Pega la URL de Sora aquí" style="width:80%" />
  <button id="btn">Obtener y Descargar</button>
  <p id="status"></p>

  <script>
    const vercelApi = 'https://sora2-nu.vercel.app/api/download'; // tu Vercel endpoint
    const workerBase = 'https://youtub-lake-6929.juniscottmatagalpa.workers.dev'; // tu Worker
    // PARA PRUEBAS: la key del worker (solo pruebas). En producción, NO ponerla en cliente.
    const workerApiKey = 'mi-super-secreto-123';

    document.getElementById('btn').addEventListener('click', async () => {
      const url = document.getElementById('inputUrl').value.trim();
      const status = document.getElementById('status');
      status.textContent = '';
      if (!url) { status.textContent = 'Ingresa una URL'; return; }

      try {
        status.textContent = 'Llamando al backend (Vercel)...';
        const resp = await fetch(vercelApi, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ video_url: url })
        });
        if (!resp.ok) {
          const text = await resp.text();
          status.textContent = 'Error del backend: ' + resp.status + ' ' + text;
          return;
        }
        const body = await resp.json();
        if (body.code !== 200 || !body.data || !body.data.encoded_video_url) {
          status.textContent = 'Respuesta inesperada: ' + JSON.stringify(body);
          return;
        }
        const encoded = encodeURIComponent(body.data.encoded_video_url);
        // Construir URL al worker; añadimos api_key en query para pruebas rápidas
        const final = `${workerBase}/?url=${encoded}&api_key=${encodeURIComponent(workerApiKey)}`;
        status.textContent = 'Redirigiendo para descarga...';
        // Navegar: forzará que el navegador descargue el archivo (gracias a Content-Disposition)
        window.location.href = final;
      } catch (err) {
        console.error(err);
        status.textContent = 'Error: ' + err.message;
      }
    });
  </script>
</body>
</html>

