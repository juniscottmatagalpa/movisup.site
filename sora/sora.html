<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sora2 Downloader</title>
<style>
  .hidden { display:none; }
  .container { max-width: 600px; margin:auto; padding:20px; font-family:Arial; }
  textarea { width:100%; height:80px; margin-bottom:10px; }
  button { padding:10px; margin-right:5px; }
  .status { margin-top:10px; font-weight:bold; }
  .result img { width:100%; border-radius:10px; margin-bottom:10px; }
</style>
</head>

<body>
<main class="container">
<h1>Sora2 Downloader</h1>

<textarea id="link-input" placeholder="Pega el enlace del video Sora..."></textarea>
<button id="download-btn" disabled>Download</button>
<button id="clear-btn" class="hidden">Clear</button>

<div id="status" class="status"></div>

<section id="video-result" class="hidden result">
  <img id="thumb">
  <p><strong>Prompt:</strong> <span id="prompt"></span></p>
  <p><strong>Resolución:</strong> <span id="res"></span></p>
  <button id="download-main">Descargar HD</button>
  <button id="download-nwm">Descargar Original</button>
</section>
</main>

<script>
const $ = id => document.getElementById(id);

function showStatus(msg){ $("status").textContent = msg }


async function download(){
  const url = $("link-input").value.trim();
  if(!url) return showStatus("Ingresa un enlace válido");

  showStatus("Procesando...");
  $("download-btn").disabled = true;

  try {
    const res = await fetch("https://movisup-site.vercel.app/api/download", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ url })
    });

    const json = await res.json();

    if(json.code !== 200){
      showStatus(json.message || "Error procesando el video");
      if (json.raw) {
        console.log("DEBUG raw:", json.raw);
      }
      $("download-btn").disabled = false;
      return;
    }

    const v = json.data;

    if (v.thumbnail) $("thumb").src = v.thumbnail;
    else $("thumb").src = "";

    $("prompt").textContent = v.prompt || "No disponible";
    $("res").textContent = (v.width && v.height) ? `${v.width}x${v.height}` : "No disponible";

    if (v.video_url) {
      $("download-main").onclick = () => window.open(v.video_url);
      $("download-main").disabled = false;
    } else {
      $("download-main").onclick = null;
      $("download-main").disabled = true;
    }

    if (v.no_watermark_url) {
      $("download-nwm").onclick = () => window.open(v.no_watermark_url);
      $("download-nwm").disabled = false;
    } else {
      $("download-nwm").onclick = null;
      $("download-nwm").disabled = true;
    }

    $("video-result").classList.remove("hidden");
    showStatus("Listo!");
    if (v.raw_preview) console.log("RAW preview (debug):", v.raw_preview);

  } catch (err){
    showStatus("Error: " + err.message);
  }

  $("download-btn").disabled = false;
}



  

$("link-input").oninput = () => {
  const has = $("link-input").value.trim().length > 0;
  $("download-btn").disabled = !has;
  $("clear-btn").classList.toggle("hidden", !has);
};

$("download-btn").onclick = download;
$("clear-btn").onclick = () => { $("link-input").value = ""; };
</script>
</body>
</html>


