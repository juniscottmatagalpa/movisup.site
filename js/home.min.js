!function(){function e(e){return document.querySelector(e)}function t(){var t=e("#download-form");if(t){var n=e("#video-url"),o=e("#progress-bar"),r=e("#progress-fill"),a=e("#loading-state"),s=e("#error-state"),i=e("#error-message");let d=null;function l(e){t.classList.remove("hidden"),a.classList.add("hidden"),s.classList.remove("hidden"),i.textContent=e,window.scrollTo({top:s.getBoundingClientRect().top+window.scrollY-100,behavior:"smooth"})}function c(){o.classList.remove("hidden");let e=0;r.style.width="0%",d=setInterval(function(){(e+=15*Math.random())>90&&(e=90),r.style.width=e+"%"},200)}function u(e){d&&(clearInterval(d),d=null),e?r.style.width="100%":(o.classList.add("hidden"),r.style.width="0%")}async function m(e){e.preventDefault();const o=(n.value||"").trim();if(!o)return void l("Please enter a valid Sora URL");const r=/^[A-Za-z0-9_\-]+$/.test(o)||o.includes("sora.chatgpt.com");if(!r)return void l("Enter a Sora permalink (sora.chatgpt.com/p/...) or a valid Sora ID");t.classList.add("hidden"),s.classList.add("hidden"),a.classList.remove("hidden"),c();const d=window.soraDownloadRoute||"/download",m=document.querySelector('meta[name="csrf-token"]'),f=m?m.getAttribute("content"):"";try{const e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f,Accept:"application/json"},body:JSON.stringify({url:o})}),t=await e.json();u(!0),t.success&&t.post_id?setTimeout(function(){window.location.href="/v/"+t.post_id},400):(u(!1),l(t.error||"Failed to process video"))}catch(e){u(!1),l("Network error. Please try again.")}}t.addEventListener("submit",m),window.copyPageLink=function(e){const t=e.target.closest("button");if(!t)return;const n=t.innerHTML;navigator.clipboard.writeText(window.location.href).then(function(){t.innerHTML='<i class="fas fa-check mr-2"></i><span class="text-xs">Copied!</span>',t.classList.add("from-green-500","to-green-600"),setTimeout(function(){t.innerHTML=n,t.classList.remove("from-green-500","to-green-600")},2e3)}).catch(function(e){alert("Failed to copy: "+e)})},window.likeVideo=function(e){const t=e.target.closest("button");if(!t)return;const n=t.querySelector("i"),o=t.innerHTML;n&&n.classList.add("animate-bounce"),t.classList.add("scale-110"),setTimeout(function(){t.innerHTML='<i class="fas fa-heart mr-2"></i><span class="text-xs">Liked!</span>'},300),setTimeout(function(){t.innerHTML=o,n&&n.classList.remove("animate-bounce"),t.classList.remove("scale-110")},2e3)},window.shareVideo=function(e){navigator.share?navigator.share({title:"Sora Video Downloader - Download Without Watermark",text:"Download Sora AI videos without watermark for free!",url:window.location.href}).catch(function(e){console.log("Share failed:",e)}):window.copyPageLink(e)}}}"complete"===document.readyState||"interactive"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)}();
